---
import { formatDate, projects } from "../data/portfolio";
import Layout from "../layouts/Layout.astro";

// Ordenar proyectos por fecha y filtrar los no archivados primero
const sortedProjects = [...projects].sort((a, b) => {
  if (!a.startDate || !b.startDate) return 0;
  return new Date(b.startDate).getTime() - new Date(a.startDate).getTime();
});

const activeProjects = sortedProjects.filter(
  (p) => !p.isArchived && !p.isComingSoon
);
const archivedProjects = sortedProjects.filter((p) => p.isArchived);
const comingSoonProjects = sortedProjects.filter((p) => p.isComingSoon);
---

<Layout title="Proyectos">
  <main class="bg-background text-foreground min-h-screen py-12">
    <div class="container mx-auto px-4 max-w-4xl">
      <header
        class="mb-12 bg-card p-8 rounded-lg border border-border shadow-md hero-section"
        transition:animate="fade"
      >
        <h1 class="text-4xl font-semibold mb-4 text-primary">Proyectos</h1>
        <p class="text-lg text-muted-foreground">
          Una colección de mis proyectos personales y profesionales, mostrando
          mi experiencia en desarrollo web y software.
        </p>
      </header>

      <!-- Active Projects -->
      <section class="mb-12 projects-grid">
        <div class="grid gap-6">
          {
            activeProjects.map((project) => (
              <article class="bg-card p-6 rounded-lg border border-border shadow-md hover:shadow-lg transition-shadow duration-300">
                <div class="flex flex-col md:flex-row justify-between gap-4">
                  <div class="flex-1">
                    <h2 class=" text-2xl mb-2">
                      <a
                        href={project.link}
                        class="text-primary hover:text-accent transition-colors duration-200"
                      >
                        {project.title}
                      </a>
                    </h2>
                    {project.startDate && (
                      <p class=" text-sm text-muted-foreground mb-2">
                        {formatDate(project.startDate)}
                      </p>
                    )}
                    <p class=" text-muted-foreground mb-4">
                      {project.description}
                    </p>
                    <div class="flex flex-wrap gap-2">
                      {project.techs.map((tech) => (
                        <span class="text-xs px-3 py-1 bg-muted rounded-full text-muted-foreground">
                          {tech}
                        </span>
                      ))}
                    </div>
                  </div>
                  <div class="flex flex-row md:flex-col gap-2 items-start">
                    {project.link && (
                      <a
                        href={project.link}
                        class="w-full px-4 text-center py-2 bg-card hover:bg-muted text-muted-foreground rounded-lg border border-border transition-colors duration-200 text-sm "
                        target="_blank"
                        rel="noopener noreferrer"
                      >
                        GitHub
                      </a>
                    )}
                    {project.link && (
                      <a
                        href={project.link}
                        class="px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors duration-200 text-sm "
                        target="_blank"
                        rel="noopener noreferrer"
                      >
                        Ver Proyecto
                      </a>
                    )}
                  </div>
                </div>
              </article>
            ))
          }
        </div>
      </section>

      <!-- Coming Soon Projects -->
      {
        comingSoonProjects.length > 0 && (
          <section class="mb-12">
            <h2 class=" text-2xl text-primary mb-6">Próximamente</h2>
            <div class="grid gap-6">
              {comingSoonProjects.map((project) => (
                <article class="bg-card p-6 rounded-lg border border-border shadow-md opacity-75">
                  <h3 class=" text-xl mb-2">
                    {project.title}
                    <span class="ml-2 text-sm text-accent">(Coming Soon)</span>
                  </h3>
                  <p class=" text-muted-foreground mb-4">
                    {project.description}
                  </p>
                  <div class="flex flex-wrap gap-2">
                    {project.techs.map((tech) => (
                      <span class="text-xs px-3 py-1 bg-muted rounded-full text-muted-foreground">
                        {tech}
                      </span>
                    ))}
                  </div>
                </article>
              ))}
            </div>
          </section>
        )
      }

      <!-- Archived Projects -->
      {
        archivedProjects.length > 0 && (
          <section class="mb-12">
            <h2 class=" text-2xl text-primary mb-6">Proyectos Archivados</h2>
            <div class="grid gap-6">
              {archivedProjects.map((project) => (
                <article class="bg-card p-6 rounded-lg border border-border shadow-md opacity-75">
                  <div class="flex flex-col md:flex-row justify-between gap-4">
                    <div class="flex-1">
                      <h3 class=" text-xl mb-2">{project.title}</h3>
                      {project.startDate && (
                        <p class=" text-sm text-muted-foreground mb-2">
                          {formatDate(project.startDate)}
                        </p>
                      )}
                      <p class=" text-muted-foreground mb-4">
                        {project.description}
                      </p>
                      <div class="flex flex-wrap gap-2">
                        {project.techs.map((tech) => (
                          <span class="text-xs px-3 py-1 bg-muted rounded-full text-muted-foreground">
                            {tech}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                </article>
              ))}
            </div>
          </section>
        )
      }
    </div>
  </main>
</Layout>
